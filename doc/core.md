Кратко ход выполнения:

 1. Инициализация графа со всеми целями.
 2. Выделение планов выполнения.
 3. Выполнение планов.

Памятка по архитектуре:

![Arch](/bem/apw/raw/master/doc/arch.png)

Архитектура сборки (**Arch**/[arch.js](/bem/apw/blob/master/lib/arch.js "arch.js")) содержит в себе все цели сборки и связи между ними. Цель (parent) не выполнится, пока не отработают успешно её дети (children).

![Arch](/bem/apw/raw/master/doc/graph.png)

Для выполнения цели из графа выделяется план выполнения (**Plan**/[plan.js](/bem/apw/blob/master/lib/plan.js "plan.js")). Он содержит в себе копию подграфа без лишних ссылок. На картинке ниже план выполнения цели 'C'.

![Plan](/bem/apw/raw/master/doc/plan.png)

Основная задача плана — выдавать в правильном порядке цели для выполнения. В примере выше последовательность приведёт к вот такому исходнику (не именно такой, только иллюстрирует):

    plan.nextJob(); // -> 'E'
    plan.nextJob(); // -> 'G'
    plan.nextJob(); // -> 'D', если успешно выполнился 'E'
    plan.nextJob(); // -> 'F', если успешно выполнился 'G'
    plan.nextJob(); // -> 'C', если успешно выполнились 'D' и 'F'

Выполнением целей заведует сущность **Workers**/[workers.js](/bem/apw/blob/master/lib/workers.js "workers.js"). Предназначенные на выполнение планы передаются в Pool, задачи которого:

 1. Запрашивать у планов задачи на выполнение.
 2. Не выполнять задачу плана, если она в данный момент выполняется из другого плана. Так повышается вероятность ускорения выполнения пересекающихся по задачам планов.
 3. Ограничивать количество одновременно выполняемых задач соответственно настройкам.

У пользовательского кода (того, что в коде целей) есть следующие пути влияния на выполнение:

 * Редактирование графа. Любое изменение отражается также на планах, потому цель попадает в пул выполнения, если она связана с целями плана. Следует изменять граф в пределах целей, выполнение которых невозможно без завершения работы цели, меняющей граф.
 * Возвращение результата выполнения. Если всё ok, план продолжает выполняться. Если fail, выполнение останавливается.